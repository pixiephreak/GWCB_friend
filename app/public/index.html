<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" content="text">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Friend Finder</title>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<!-- Compiled and minified CSS -->
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
 <!-- Compiled and minified JavaScript -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
 <link rel="stylesheet" href="css/styles.css">
 <script src="js/questions.js" type="text/javascript"></script>
</head>

<body id='body' class="card-panel #e1f5fe light-blue lighten-5">
	<h1>Find a Friend</h1>
	<p> Thinkers such as Maya Angelou have noted that “ ... in diversity there is beauty and there is strength.”
 				However, more recently people like Joel D. Anderson have pointed out that "...judging people on their politics is entirely appropriate. Politics is a vehicle through which they wish to shape the world."
	</p>
	<h2>Fill out the survey below to find a friend with similar or different political opinions</h2>
	<h2>Would you like to:</h2>
			<form action='' method=''>
				<input type="radio" name="proximity" value="similar" checked>find a friend who shares your politics<br>
				<input type="radio" name="proximity" value="somewhat-similar">find someone who shares some of your political attitudes, but differs on others<br>
				<input type="radio" name="proximity" value="different">find someone whose views differ significantly<br>
			</form>
	<h2>About You</h2>
	<form>
		Name(Required): <input type="text" name="name" placeholder="name" id="name"> Photo(Optional): <input type="text" name="photo" placeholder="link to a photo" id="photo">
		<div id='survey'></div>
		<div id="results">
		</h1></h1>
		</div>
		<button type="submit" class="btn btn-primary submit" id="submit">Submit</button>
	</form>

</body>

<script type="text/javascript">
	$(document).ready(function() {
		var questions = [{
			"question": "Are you registered with a political party or would you be if you had the right to vote in the U.S.?",
			"answers": [{
					"answer": "Yes, I am a Republican.",
					"score": 1
				},
				{
					"answer": "Yes, I'm a Democrat",
					"score": 2
				},
				{
					"answer": "Yes, I'm a third party voter",
					"score": 0
				},
				{
					"answer": "Democracy is broken, so I find other ways to take political action.",
					"score": 3
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": "Do you:",
			"answers": [{
					"answer": "support the policies and ideology of the Trump regime?",
					"score": 1
				},
				{
					"answer": "think it's a shame that Trump was able to manipulate people's interest in order to gain power?",
					"score": 2
				},
				{
					"answer": "detest Donald Trump on political, ideological, and personal terms?",
					"score": 3
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": "You think that any nation's borders:",
			"answers": [{
					"answer": "should be closed to all immigrants and refugees.",
					"score": 1
				},
				{
					"answer": "should be open, but clearly defined procedures for immigrating should be established and followed.",
					"score": 2
				},
				{
					"answer": "are imaginary constructs that should not factor into where how people move through their world.",
					"score": 3
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": " Women:",
			"answers": [{
					"answer": "have the right to make any and all decisions regarding their personal health and should have explicitly protected access to resources needed to do so.",
					"score": 3
				},
				{
					"answer": "should have access to the same and only the same healthcare resources as men (other services should be available, but billed additionally on an individual basis).",
					"score": 2
				},
				{
					"answer": "Should not be allowed to make decisions about their bodies that could prevent or terminate pregnancy.",
					"score": 1
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": " Racism:",
			"answers": [{
					"answer": "Exists.",
					"score": 3
				},
				{
					"answer": "Existed before, but was fixed.",
					"score": 2
				},
				{
					"answer": "Doesn't Exist.",
					"score": 1
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": "Scientific research:",
			"answers": [{
					"answer": "proves that the climate is warming as a direct result of human activities.",
					"score": 3
				},
				{
					"answer": "suggests the climate is warming, but can't determine exactly why.",
					"score": 2
				},
				{
					"answer": "does not in any way prove or disprove global climate change.",
					"score": 1
				}, {
					"answer": "shows a natural and expected pattern of warming and cooling.",
					"score": 1
				},
				{
					"answer": "shows a natural and expected pattern of warming and cooling.",
					"score": 1
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": "The right to determine and express one's own gender identity:",
			"answers": [{
					"answer": "is fundamental and should be respected, protected and embraced by others.",
					"score": 3
				},
				{
					"answer": "is up to the individual, but protecting it shouldn't be a priority for lawmakers.",
					"score": 2
				},
				{
					"answer": "is unnatural and wrong",
					"score": 1
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": "If an individual lives in poverty, it's because:",
			"answers": [{
					"answer": "s/he's lazy.",
					"score": 1
				},
				{
					"answer": "of a complex web of circumstances, some of which are in her control and some of which aren't.",
					"score": 2
				},
				{
					"answer": "the American Dream of social mobility is a fallacy.",
					"score": 3
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": " Labor Unions:",
			"answers": [{
					"answer": "protect worker's rights to safe conditions and access to fair pay.",
					"score": 3
				},
				{
					"answer": "severely limit companies' ability to be efficient and productive.",
					"score": 1
				},
				{
					"answer": "serve a purpose, but are often corrupt.",
					"score": 2
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}, {
			"question": "Guns:",
			"answers": [{
					"answer": "do not belong in the hands of civilians or governmental bodies.",
					"score": 3
				},
				{
					"answer": "should not be controlled or regulated by the government.",
					"score": 1
				},
				{
					"answer": "should be available to individuals, but only after extensive background checks.",
					"score": 2
				},
				{
					"answer": "None of these answers reflect my point of view",
					"score": 0
				}
			]
		}];

		//loop through questions and append them to the dom
		var survey = document.getElementById('survey');
		count = 1;
		questions.forEach(function(question) {
			var questionText = question.question;
			var questionAnswers = question.answers;
			var fieldset = document.createElement('fieldset');
			question = document.createElement('p');
			question.innerHTML = questionText;
			fieldset.appendChild(question);
			questionAnswers.forEach(function(question) {
				var input = document.createElement('input');
				var label = document.createElement('label');
				var br = document.createElement('br')
				label.innerHTML = question.answer;
				input.setAttribute("type", 'radio');
				input.setAttribute("name", 'answer' + count);
				input.setAttribute("value", question.score);
				fieldset.appendChild(input);
				fieldset.appendChild(label);
				fieldset.appendChild(br)
			})
			survey.appendChild(fieldset);
			count++
		});

		var Friend = function(name, photo, scores, proximity) {
			this.name = name;
			this.photo = photo;
			this.scores = scores;
			this.proximity = proximity;
			if (!(this instanceof Friend)) {
				return new Friend(name, photo, scores);
			}
		};

		Friend.prototype.totalScore = function() {};

		//send scores to server on submit
		document.getElementById('submit').onclick = function(event) {
			event.preventDefault();

			var name = document.getElementById('name').value;
			var photo = document.getElementById('photo').value;
			var fieldsets = document.getElementsByTagName('fieldset');
			var length = fieldsets.length + 1;

			function storeScores() {
				var scores = [];
				for (let i = 1; i < length; i++) {
					//confirm that all fields are completed
					if (document.querySelector(`input[name = "answer${i}"]:checked`) != null) {
						//store scores in array
						var score = document.querySelector(`input[name = "answer${i}"]:checked`).value;
						scores.push(score);
					} else {
						alert("please complete all questions on the survey")
						break;
					}
				}
				return scores;
			}

			function storeProximity() {
				var proximity;
				for (let i = 1; i < length; i++) {
					//confirm that all fields are completed
					if (document.querySelector(`input[name = "proximity"]:checked`) != null) {
						//store scores in array
					proximity = document.querySelector(`input[name = "proximity"]:checked`).value;
					} else {
						alert("please choose your friend style")
						break;
					}
				}
				return proximity;
			}

			if (storeScores().length === 10) {
				newUser = new Friend(name, photo, storeScores(), storeProximity());
			}

			var currentURL = window.location.origin;

			var settings = {
				"async": true,
				"crossDomain": true,
				"url": currentURL + "/api/friends",
				"method": "POST",
				"dataType": "json",
				"headers": {
					"cache-control": "no-cache"
				},
				"data": JSON.stringify(newUser),
				"contentType": "application/json; charset=utf-8"
			};

			function append(data){
				console.log(data);
				var elem = document.createElement('h1');
				elem.innerHTML = 'Results';
				var results = document.createElement('p');
				elem.innerHTML = `Your Best Friend is: ${data.name}`;
				document.getElementById('results').innerHTML = "";
				document.getElementById('results').appendChild(elem);
				console.log('appending'+ data.name);
			};

			if (newUser) {
				$.ajax(settings).done(function(response) {
					// console.log(response);
					append(response);
				}).fail(function() {
					alert("Sorry. Server unavailable. ");
				});

			};
		};
	});
</script>


</html>
